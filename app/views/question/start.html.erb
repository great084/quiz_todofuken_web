<%= Gon::Base.render_data %>

<div class="container">
  <h1>「クイズ開始」ボタンを押して、クイズを始めよう</h1>

  <!-- モーダル起動ボタン -->
  <button class="btn btn-lg btn-block btn-success quiz-start" data-toggle="modal" data-target="#quizModal">クイズ開始</button>
</div>

  <!-- モーダルウィンドウ -->
  <div class="modal fade" id="quizModal" tabindex="1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="question-title">モーダルタイトル</h5>
        </div>
        <div class="modal-body">
          <h2 id="question">ここに問題が表示されます。</h2>

          <div class="row answers my-3">
            <div class="col-6 answer py-2">
              <button class="btn btn-lg btn-primary btn-block">選択肢１</button>
            </div>
            <div class="col-6 answer py-2">
              <button class="btn btn-lg btn-primary btn-block">選択肢１</button>
            </div>
            <div class="col-6 answer py-2">
              <button class="btn btn-lg btn-primary btn-block">選択肢１</button>
            </div>
            <div class="col-6 answer py-2">
              <button class="btn btn-lg btn-primary btn-block">選択肢１</button>
            </div>
          </div>
          <h1 class="question-judge"></h1>
        </div>
        <div class="modal-footer">
          <button class="btn btn-lg btn-block btn-success quiz-next">次の問題へ</button>
          <button class="btn btn-lg btn-block btn-success quiz-end" disabled>クイズ終了</button>
        </div>
      </div>
    </div></div>



<script>

// 問題を表示するオブジェクトを取得する
// var Q = document.getElementById('question');
// Q.textContent = gon.quiz_data[0][0];

$(function(){
  var $q_cnt = 0;
  var $correct_cnt = 0;

  var displayTitle = function(cnt, total){
    $('#question-title').text("第；" + (cnt) + "問   /   全：" + total + "問");
  }

  var displayQuestionAndAnswers = function(cnt){
    // 問題文の表示
    $('#question').text("問題： " + gon.quiz_data[cnt][0] + "の県庁所在地は？")
    // 回答選択肢の並べ替えと表示
    var $slide = Math.floor(Math.random() * 4);
    for (var i=0; i<4; i++){
      var j = (i + $slide ) % 4 ; 
      $('.answer').eq(j).children('.btn').text(gon.quiz_data[$q_cnt][i+1]);
      if (i==0){
        $('.answer').eq(j).children('.btn').addClass('correct_answer');
      }
      $('.answers').find('.btn').prop('disabled', false)
    }
  }

  $('.quiz-start').click( function(){
    displayTitle(1, gon.quiz_data.length);
    displayQuestionAndAnswers(0)
    $q_cnt++
  })

  $('.quiz-next').click( function(){

    displayTitle($q_cnt + 1, gon.quiz_data.length);
    displayQuestionAndAnswers($q_cnt);

    // var $slide = Math.floor(Math.random() * 4);

    // $('#question').text("問題： " + gon.quiz_data[$q_cnt][0] + "の県庁所在地は？")

    // for (var i=0; i<4; i++){
    //   var j = (i + $slide ) % 4 ; 
    //   // console.log(gon.quiz_data[0][i]);
    //   // $('.answers .answer:nth-child(" + i + ") .btn').text(gon.quiz_data[0][i]);
    //   $('.answer').eq(j).children('.btn').text(gon.quiz_data[$q_cnt][i+1]);
    //   if (i==0){
    //     $('.answer').eq(j).children('.btn').addClass('correct_answer');
    //   }
    //   $('.answers').find('.btn').prop('disabled', false)
    // }
    $q_cnt++;
  });

  $('.answer').children('.btn').click( function(){
    if ($(this).hasClass('correct_answer')){
      $('.question-judge').text("正解です！");
      $correct_cnt++;
    }else{
      $('.question-judge').text("違います！");
    }
    $('.answers').find('.btn').prop('disabled', true).removeClass('correct_answer');
    // $('.answers').find('.btn').addClass('btn-secondary');

    if ($q_cnt == gon.quiz_data.length){
      $('.quiz-next').prop('disabled', true);
      $('.quiz-end').prop('disabled', false);
    }
  });

});

</script>